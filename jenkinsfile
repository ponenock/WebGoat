pipeline {
    agent any
    environment {
        // The following variable is required for a Semgrep Cloud Platformâ€“connected scan:
        SEMGREP_APP_TOKEN = credentials('SEMGREP_APP_TOKEN')
    }
    stages {
        stage('Semgrep-Scan') {
            steps {
                sh '''
                docker pull returntocorp/semgrep && \
                docker run \
                -e SEMGREP_APP_TOKEN=$SEMGREP_APP_TOKEN \
                -v "$(pwd)":/src \
                --workdir /src \
                returntocorp/semgrep semgrep ci
                '''
            }
        }
    }
}
